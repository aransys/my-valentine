<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Be My Valentine?</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="theme-color" content="#e73c7e" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        -webkit-tap-highlight-color: transparent;
      }

      html,
      body {
        width: 100%;
        min-height: 100%;
        min-height: 100dvh;
        overflow-x: hidden;
      }

      body {
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
        padding: 1rem;
        padding-bottom: env(safe-area-inset-bottom);
      }

      @keyframes gradient {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }

      .container {
        text-align: center;
        background: rgba(0, 0, 0, 0.2);
        padding: clamp(1.25rem, 5vw, 2rem);
        border-radius: clamp(16px, 4vw, 20px);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
        width: 100%;
        max-width: 90%;
        z-index: 1;
      }

      h1 {
        color: #fff;
        font-size: clamp(1.5rem, 6vw, 2.5rem);
        margin-bottom: clamp(0.75rem, 3vw, 1.25rem);
        text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.4), 0 0 20px rgba(0, 0, 0, 0.2);
        line-height: 1.3;
      }

      p {
        color: rgba(255, 255, 255, 0.95);
        font-size: clamp(1rem, 3.5vw, 1.2rem);
        margin-bottom: clamp(1.25rem, 4vw, 1.875rem);
        text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.4);
        line-height: 1.5;
      }

      .buttons {
        display: flex;
        flex-wrap: wrap;
        gap: clamp(0.75rem, 4vw, 1.25rem);
        justify-content: center;
        align-items: center;
      }

      button {
        background-color: rgba(255, 255, 255, 0.2);
        color: #fff;
        border: 2px solid rgba(255, 255, 255, 0.9);
        padding: clamp(0.875rem, 4vw, 1rem) clamp(1.5rem, 6vw, 2rem);
        font-size: clamp(1rem, 4vw, 1.125rem);
        cursor: pointer;
        border-radius: 999px;
        transition: transform 0.2s, background-color 0.2s;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        min-width: 100px;
        min-height: 48px;
        touch-action: manipulation;
      }

      button:hover,
      button:focus-visible {
        background-color: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
        outline: 2px solid #fff;
        outline-offset: 2px;
      }

      button:active {
        transform: scale(0.98);
      }

      #yesBtn {
        background-color: rgba(255, 255, 255, 0.4);
        font-weight: 700;
        text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.3);
        box-shadow: 0 0 12px rgba(255, 255, 255, 0.4);
      }

      .moving-button {
        position: fixed;
        z-index: 1000;
        background-color: rgba(255, 255, 255, 0.25);
        color: #fff;
        border: 2px solid rgba(255, 255, 255, 0.9);
        padding: clamp(0.75rem, 3vw, 1rem) clamp(1rem, 4vw, 1.5rem);
        font-size: clamp(0.875rem, 3.5vw, 1rem);
        cursor: pointer;
        border-radius: 999px;
        transition: transform 0.15s, background-color 0.15s;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        white-space: nowrap;
        min-height: 48px;
        touch-action: manipulation;
        text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.3);
      }

      .moving-button:hover,
      .moving-button:focus-visible {
        background-color: rgba(255, 255, 255, 0.35);
        transform: scale(1.05);
        outline: 2px solid #fff;
        outline-offset: 2px;
      }

      .heart {
        position: fixed;
        pointer-events: none;
        z-index: 999;
        font-size: clamp(20px, 5vw, 28px);
        animation: float-heart 4s ease-out forwards;
      }

      @keyframes float-heart {
        0% { transform: translateY(100vh) scale(0.3); opacity: 0; }
        10% { opacity: 1; }
        100% { transform: translateY(-20vh) scale(1.5) rotate(360deg); opacity: 0; }
      }

      .success-message {
        animation: scale-in 0.5s ease-out forwards;
      }

      @keyframes scale-in {
        0% { transform: scale(0.8); opacity: 0; }
        100% { transform: scale(1); opacity: 1; }
      }

      .success-message h1 {
        font-size: clamp(1.75rem, 8vw, 3rem);
      }

      .success-message p {
        font-size: clamp(1rem, 4vw, 1.5rem);
      }

      .capybara-wrapper {
        width: 100%;
        max-width: min(400px, 90vw);
        margin: 1.5rem auto;
        aspect-ratio: 10 / 3;
      }

      .capybara-wrapper svg {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .emoji {
        position: fixed;
        pointer-events: none;
        z-index: 999;
        font-size: clamp(20px, 5vw, 28px);
        animation: spread-out 1.5s ease-out forwards;
      }

      @keyframes spread-out {
        0% { transform: translate(0, 0); opacity: 0; }
        5% { opacity: 1; }
        100% { transform: translate(var(--moveX), var(--moveY)); opacity: 0; }
      }

      .firework {
        position: fixed;
        pointer-events: none;
        z-index: 999;
      }

      .firework::before {
        content: "";
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #fff;
        box-shadow: 0 0 4px #fff;
        animation: firework-explode 2s ease-out forwards;
      }

      @keyframes firework-explode {
        0% {
          transform: scale(1);
          opacity: 1;
          box-shadow: 0 0 0 0 #fff, 0 0 0 0 #fff, 0 0 0 0 #fff, 0 0 0 0 #fff,
                      0 0 0 0 #fff, 0 0 0 0 #fff, 0 0 0 0 #fff, 0 0 0 0 #fff;
        }
        100% {
          transform: scale(0);
          opacity: 0;
          box-shadow: -80px -80px 0 rgba(255,255,255,0.8), 80px -80px 0 rgba(255,255,255,0.8),
                      -80px 80px 0 rgba(255,255,255,0.8), 80px 80px 0 rgba(255,255,255,0.8),
                      0 -120px 0 rgba(255,255,255,0.8), 0 120px 0 rgba(255,255,255,0.8),
                      120px 0 0 rgba(255,255,255,0.8), -120px 0 0 rgba(255,255,255,0.8);
        }
      }

      .no-clicks-count {
        font-size: 0.9em;
        opacity: 0.9;
        margin-top: 1rem;
      }

      @media (min-width: 600px) {
        .capybara-wrapper {
          max-width: 500px;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }
    </style>
  </head>
  <body>
    <div class="container" role="main">
      <h1>Will you be my Valentine?</h1>
      <p>I've been wanting to ask you...</p>
      <div class="buttons">
        <button id="yesBtn" aria-label="Say yes">Yes</button>
        <button id="noBtn" aria-label="Say no">No</button>
      </div>
    </div>

    <div id="liveRegion" aria-live="polite" aria-atomic="true" class="sr-only"></div>

    <script>
      const sweetQuestions = [
        "Are you absolutely sure? ü•∫",
        "But what if I give you flowers? üå∏",
        "Maybe we could get coffee first? ‚òï",
        "What if I write you a love song? üéµ",
        "I promise to make you smile every day! üòä",
        "We could watch sunsets together üåÖ",
        "I'll bake you cookies! üç™",
        "Think about all the adventures we'd have! ‚ú®",
        "I've been practicing my dad jokes! üôà",
        "What if I learn your favorite song? üé∏",
      ];

      const sadEmojis = ["üò¢", "üò≠", "ü•∫", "üíî", "üòø", "üò•", "üòì", "üòî", "ü•π", "üòï"];
      let clickCount = 0;
      let recentQuestions = [];
      let heartInterval = null;
      let fireworkInterval = null;

      function haptic() {
        if (navigator.vibrate) navigator.vibrate(30);
      }

      function announce(message) {
        const live = document.getElementById("liveRegion");
        if (live) {
          live.textContent = "";
          live.textContent = message;
        }
      }

      function createSVGCapybara() {
        const svgNS = "http://www.w3.org/2000/svg";
        const svg = document.createElementNS(svgNS, "svg");
        svg.setAttribute("viewBox", "0 0 100 100");

        const body = document.createElementNS(svgNS, "ellipse");
        body.setAttribute("cx", "50");
        body.setAttribute("cy", "60");
        body.setAttribute("rx", "30");
        body.setAttribute("ry", "25");
        body.setAttribute("fill", "#916343");

        const head = document.createElementNS(svgNS, "circle");
        head.setAttribute("cx", "75");
        head.setAttribute("cy", "45");
        head.setAttribute("r", "20");
        head.setAttribute("fill", "#916343");

        const eye1 = document.createElementNS(svgNS, "circle");
        eye1.setAttribute("cx", "82");
        eye1.setAttribute("cy", "40");
        eye1.setAttribute("r", "3");
        eye1.setAttribute("fill", "#000");

        const eye2 = document.createElementNS(svgNS, "circle");
        eye2.setAttribute("cx", "70");
        eye2.setAttribute("cy", "40");
        eye2.setAttribute("r", "3");
        eye2.setAttribute("fill", "#000");

        const nose = document.createElementNS(svgNS, "ellipse");
        nose.setAttribute("cx", "77");
        nose.setAttribute("cy", "48");
        nose.setAttribute("rx", "6");
        nose.setAttribute("ry", "4");
        nose.setAttribute("fill", "#573d2a");

        const ear1 = document.createElementNS(svgNS, "circle");
        ear1.setAttribute("cx", "85");
        ear1.setAttribute("cy", "30");
        ear1.setAttribute("r", "7");
        ear1.setAttribute("fill", "#916343");

        const ear2 = document.createElementNS(svgNS, "circle");
        ear2.setAttribute("cx", "65");
        ear2.setAttribute("cy", "30");
        ear2.setAttribute("r", "7");
        ear2.setAttribute("fill", "#916343");

        const leg1 = document.createElementNS(svgNS, "rect");
        leg1.setAttribute("x", "35");
        leg1.setAttribute("y", "75");
        leg1.setAttribute("width", "8");
        leg1.setAttribute("height", "15");
        leg1.setAttribute("fill", "#916343");

        const leg2 = document.createElementNS(svgNS, "rect");
        leg2.setAttribute("x", "55");
        leg2.setAttribute("y", "75");
        leg2.setAttribute("width", "8");
        leg2.setAttribute("height", "15");
        leg2.setAttribute("fill", "#916343");

        svg.appendChild(body);
        svg.appendChild(head);
        svg.appendChild(ear1);
        svg.appendChild(ear2);
        svg.appendChild(eye1);
        svg.appendChild(eye2);
        svg.appendChild(nose);
        svg.appendChild(leg1);
        svg.appendChild(leg2);

        return svg;
      }

      function createGoose() {
        const svgNS = "http://www.w3.org/2000/svg";
        const svg = document.createElementNS(svgNS, "svg");
        svg.setAttribute("viewBox", "0 0 100 100");

        const body = document.createElementNS(svgNS, "ellipse");
        body.setAttribute("cx", "50");
        body.setAttribute("cy", "60");
        body.setAttribute("rx", "30");
        body.setAttribute("ry", "25");
        body.setAttribute("fill", "#FFFFFF");

        const neck = document.createElementNS(svgNS, "path");
        neck.setAttribute("d", "M60,45 Q70,35 65,25");
        neck.setAttribute("stroke", "#FFFFFF");
        neck.setAttribute("stroke-width", "18");
        neck.setAttribute("fill", "none");
        neck.setAttribute("stroke-linecap", "round");

        const head = document.createElementNS(svgNS, "circle");
        head.setAttribute("cx", "65");
        head.setAttribute("cy", "25");
        head.setAttribute("r", "12");
        head.setAttribute("fill", "#FFFFFF");

        const beak = document.createElementNS(svgNS, "path");
        beak.setAttribute("d", "M65,25 L85,23 L65,28 Z");
        beak.setAttribute("fill", "#FF9800");

        const eye = document.createElementNS(svgNS, "circle");
        eye.setAttribute("cx", "69");
        eye.setAttribute("cy", "23");
        eye.setAttribute("r", "2.5");
        eye.setAttribute("fill", "#000000");

        const leg1 = document.createElementNS(svgNS, "rect");
        leg1.setAttribute("x", "35");
        leg1.setAttribute("y", "75");
        leg1.setAttribute("width", "8");
        leg1.setAttribute("height", "15");
        leg1.setAttribute("fill", "#FF9800");

        const leg2 = document.createElementNS(svgNS, "rect");
        leg2.setAttribute("x", "55");
        leg2.setAttribute("y", "75");
        leg2.setAttribute("width", "8");
        leg2.setAttribute("height", "15");
        leg2.setAttribute("fill", "#FF9800");

        svg.appendChild(body);
        svg.appendChild(neck);
        svg.appendChild(head);
        svg.appendChild(beak);
        svg.appendChild(eye);
        svg.appendChild(leg1);
        svg.appendChild(leg2);

        return svg;
      }

      function createCapybaraCouple() {
        const svgNS = "http://www.w3.org/2000/svg";
        const svg = document.createElementNS(svgNS, "svg");
        svg.setAttribute("viewBox", "-100 -50 1000 300");
        svg.setAttribute("preserveAspectRatio", "xMidYMid meet");

        const capyGroup = document.createElementNS(svgNS, "g");
        const capy = createSVGCapybara();
        capyGroup.appendChild(capy);
        capyGroup.setAttribute("transform", "translate(100, 50) scale(2.5) scale(-1, 1)");

        const heartGroup = document.createElementNS(svgNS, "g");
        const heart = document.createElementNS(svgNS, "path");
        heart.setAttribute("d", "M150 35 C150 20 140 10 125 10 C110 10 100 20 100 35 C100 50 125 65 150 80 C175 65 200 50 200 35 C200 20 190 10 175 10 C160 10 150 20 150 35");
        heart.setAttribute("fill", "#FF69B4");
        heartGroup.appendChild(heart);
        heartGroup.setAttribute("transform", "translate(350, 80) scale(1.5)");

        const gooseGroup = document.createElementNS(svgNS, "g");
        const goose = createGoose();
        gooseGroup.appendChild(goose);
        gooseGroup.setAttribute("transform", "translate(700, 50) scale(-2.5, 2.5)");

        svg.appendChild(capyGroup);
        svg.appendChild(heartGroup);
        svg.appendChild(gooseGroup);

        return svg;
      }

      function createHeart() {
        const heart = document.createElement("div");
        heart.className = "heart";
        heart.innerHTML = "‚ù§Ô∏è";
        heart.style.left = Math.random() * Math.max(0, window.innerWidth - 50) + "px";
        document.body.appendChild(heart);
        setTimeout(() => heart.remove(), 4000);
      }

      function createFirework() {
        const firework = document.createElement("div");
        firework.className = "firework";
        firework.style.left = Math.random() * window.innerWidth + "px";
        firework.style.top = Math.random() * window.innerHeight + "px";
        document.body.appendChild(firework);
        setTimeout(() => firework.remove(), 2000);
      }

      function createEmojiExplosion(x, y) {
        const count = Math.min(8, Math.floor(window.innerWidth / 50));
        for (let i = 0; i < count; i++) {
          const emoji = document.createElement("div");
          emoji.className = "emoji";
          emoji.textContent = sadEmojis[Math.floor(Math.random() * sadEmojis.length)];
          const angle = (i / count) * Math.PI * 2;
          const radius = Math.min(150, window.innerWidth * 0.3);
          const moveX = Math.cos(angle) * radius;
          const moveY = Math.sin(angle) * radius;
          emoji.style.left = x + "px";
          emoji.style.top = y + "px";
          emoji.style.setProperty("--moveX", moveX + "px");
          emoji.style.setProperty("--moveY", moveY + "px");
          document.body.appendChild(emoji);
          setTimeout(() => emoji.remove(), 1500);
        }
      }

      function getUniqueQuestion() {
        const available = sweetQuestions.filter((q) => !recentQuestions.includes(q));
        if (available.length === 0) {
          recentQuestions = [];
          return sweetQuestions[Math.floor(Math.random() * sweetQuestions.length)];
        }
        const q = available[Math.floor(Math.random() * available.length)];
        recentQuestions.push(q);
        if (recentQuestions.length > 5) recentQuestions.shift();
        return q;
      }

      function createNewButton(question) {
        const q = question ?? getUniqueQuestion();
        const newBtn = document.createElement("button");
        newBtn.className = "moving-button";
        newBtn.textContent = q;
        newBtn.setAttribute("aria-label", "No, " + q);

        const btnWidth = Math.min(220, window.innerWidth - 48);
        const btnHeight = 56;
        const padding = 24;
        const maxX = Math.max(0, window.innerWidth - btnWidth - padding * 2);
        const maxY = Math.max(0, window.innerHeight - btnHeight - padding * 2);
        const newX = padding + Math.random() * maxX;
        const newY = padding + Math.random() * maxY;

        newBtn.style.left = newX + "px";
        newBtn.style.top = newY + "px";

        const getEventCoords = (e) => {
          if (e.clientX != null) return { x: e.clientX, y: e.clientY };
          const t = e.changedTouches?.[0] ?? e.touches?.[0];
          return t ? { x: t.clientX, y: t.clientY } : { x: window.innerWidth / 2, y: window.innerHeight / 2 };
        };

        const handleNoClick = (e) => {
          haptic();
          clickCount++;
          const yesBtn = document.getElementById("yesBtn");
          if (yesBtn) yesBtn.style.transform = `scale(${1 + clickCount * 0.35})`;
          const { x, y } = getEventCoords(e);
          createEmojiExplosion(x, y);
          const nextQ = getUniqueQuestion();
          createNewButton(nextQ);
          announce(nextQ);
          newBtn.remove();
        };

        newBtn.addEventListener("click", handleNoClick);
        newBtn.addEventListener("touchend", (e) => {
          if (e.cancelable) e.preventDefault();
          handleNoClick(e);
        }, { passive: false });

        document.body.appendChild(newBtn);
      }

      function stopCelebrations() {
        if (heartInterval) {
          clearInterval(heartInterval);
          heartInterval = null;
        }
        if (fireworkInterval) {
          clearInterval(fireworkInterval);
          fireworkInterval = null;
        }
      }

      window.addEventListener("beforeunload", stopCelebrations);

      const noBtn = document.getElementById("noBtn");
      noBtn.addEventListener("click", (e) => {
        haptic();
        clickCount++;
        const yesBtn = document.getElementById("yesBtn");
        yesBtn.style.transform = `scale(${1 + clickCount * 0.35})`;
        createEmojiExplosion(e.clientX, e.clientY);
        const q = getUniqueQuestion();
        announce(q);
        createNewButton(q);
        noBtn.remove();
      });

      const yesBtn = document.getElementById("yesBtn");
      yesBtn.addEventListener("click", () => {
        haptic();
        document.querySelectorAll(".moving-button").forEach((btn) => btn.remove());

        const container = document.querySelector(".container");
        const clicksText = clickCount > 0
          ? `<p class="no-clicks-count">(After ${clickCount} "No"s ‚Äî you couldn't resist! üòè)</p>`
          : "";

        container.innerHTML = `
          <div class="success-message">
            <h1>YAAAAY! üéâ</h1>
            <p>You've made my heart skip a beat! üíñ</p>
            <p>Get ready for the most amazing Valentine's ever!</p>
            <div class="capybara-wrapper" id="capybaraCouple" aria-hidden="true"></div>
            ${clicksText}
          </div>
        `;

        const capybaraCouple = document.getElementById("capybaraCouple");
        capybaraCouple.appendChild(createCapybaraCouple());

        announce("YAAAAY! You said yes! You've made my heart skip a beat.");

        stopCelebrations();
        const isMobile = window.innerWidth < 600 || "ontouchstart" in window;
        const heartDelay = isMobile ? 350 : 200;
        const fireworkDelay = isMobile ? 450 : 300;

        heartInterval = setInterval(createHeart, heartDelay);
        fireworkInterval = setInterval(createFirework, fireworkDelay);

        setTimeout(stopCelebrations, 60000);
      });

    </script>
  </body>
</html>
